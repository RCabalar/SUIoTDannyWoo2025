<template>
  <div class="chart-box">
    <h3>{{ name }} - {{ metric }} vs time</h3>
    <canvas ref="canvas"></canvas>
  </div>
</template>

<script>
import { Chart } from "chart.js/auto";

export default {
  props: {
	name: String,
	data: Array,
	metric: String
  },
  data() {
    return {
      chart: null
    };
  },
  
  mounted() {
	this.renderChart();
  },

  watch: {
    data: {
      handler() {
		this.updateChart();
	  },
	  deep: true
      }
    },
	
	methods: {
		renderChart() {
			const labels = this.data.map(d => new Date(d.timestamp));
			const values = this.data.map(d => d[this.metric]);
		
			this.chart = new Chart(this.$refs.canvas, {
				type: "line",
				data: {
					labels,
					datasets: [{
						label: '${this.metric} vs time',
						data: values,
						borderColor: "steelblue",
						borderWidth: 2,
						tension: 0.2,
						pointRadius: 0
					}]
				}
			});
		},
		
		updateChart() {
			if (!this.chart) return;
			
			this.chart.data.labels = this.data.map(d => new Date(d.timestamp));
			this.chart.data.datasets[0].data = this.data.map(d => d[this.metric]);
			this.chart.update();
		}
	}
};
</script>

<style>
.chart-box {
  margin: 35px 0;
  height: 300px;
}
</style>
